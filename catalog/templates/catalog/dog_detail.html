{% extends 'base.html' %}
{% block page_title %}{{ page_title }}{% endblock %}

{% load static %}

{% block content %}

	<div class="bg-[#EEE7DF]">
		<div class="mx-auto max-w-2xl px-4 py-8 sm:px-6 sm:py-8 lg:max-w-6xl lg:px-8">

			<div class="bg-white grid grid-cols-1 lg:grid-cols-2 lg:lg:auto-rows-auto shadow-lg rounded-3xl border-b-3 border-solid border-base-300 ring-1 ring-black/5">

				<!-- Блок 1 -->
				<div class="p-4 gap-8">
					<div class="relative w-full aspect-square rounded-3xl  overflow-hidden">
						{% with image=dog.avatar %}
							{% if image %}
								<img src="{{ image.image.url }}" alt="{{ dog.name }} — главное фото"
								     class="w-full h-full object-cover z-0" loading="lazy">
							{% endif %}
						{% endwith %}

						{% if dog.status %}
							<span class="absolute top-4 right-4 z-10 inline-flex items-center gap-x-1.5 py-1.5 px-3 rounded-full text-[10px] md:text-xs font-montserrat font-medium bg-black/40 text-white ring-1 ring-neutral-800/50 ring-inset">
                {{ dog.get_status_display }}
            </span>
						{% endif %}
					</div>
				</div>

				<!-- Блок 2 -->
				<div class="relative flex flex-col h-full p-8">
					<h2 class="text-5xl font-lora text-gray-800">{{ dog.name }}</h2>
					<p class="mt-4 text-gray-600 font-montserrat">{{ dog.description }}</p>
					<div class="mt-4 space-y-3">
						{% if dog.birth_date %}
							<div class="flex justify-between border-b pb-2 border-gray-200">
								<div class="text-gray-600 font-montserrat">Дата рождения:</div>
								<div class="font-medium text-lg text-gray-800 font-montserrat">{{ dog.birth_date }}</div>
							</div>
						{% endif %}

						<div class="flex justify-between border-b pb-2 border-gray-200">
							<div class="text-gray-600 font-montserrat">Пол:</div>
							<div class="font-medium text-lg text-gray-800 font-montserrat">{{ dog.get_gender_display }}</div>
						</div>

						{% if dog.dog_type %}
							<div class="flex justify-between border-b pb-2 border-gray-200">
								<div class="text-gray-600 font-montserrat">Тип:</div>
								<div class="text-lg font-medium text-gray-800 font-montserrat">{{ dog.dog_type }}</div>
							</div>
						{% endif %}

						{% if dog.color %}
							<div class="flex justify-between border-b pb-2 border-gray-200">
								<div class="text-gray-600 font-montserrat">Окрас:</div>
								<div class="font-medium text-lg text-gray-800 font-montserrat text-right">{{ dog.color }}</div>
							</div>
						{% endif %}

						{% if dog.litter %}
    <div class="flex justify-between border-b pb-2 border-gray-200">
        <div class="text-gray-600 font-montserrat">Родители:</div>
        <div class="font-medium text-lg font-montserrat text-right">
            <a href="{% url 'catalog:litter_detail' dog.litter.slug %}" class="text-blue-600 hover:text-blue-800">
                {{ dog.litter }}
            </a>
        </div>
    </div>
{% endif %}

						{% if dog.price %}
							<div class="flex justify-between border-b pb-2 border-gray-200">
								<div class="text-gray-600 font-montserrat">Стоимость:</div>
								<div class="font-medium text-lg text-gray-800 font-montserrat">{{ dog.price }} ₽</div>
							</div>
						{% endif %}

						<!-- Кнопки -->
						<div class="mt-7 grid grid-cols-1 md:grid-cols-2 gap-3 w-full">
							{% if dog.pedigree %}
								<a class="font-montserrat py-3 px-4 justify-center inline-flex items-center gap-x-1 text-sm font-medium rounded-2xl border border-gray-200 bg-white text-gray-800 shadow-2xs hover:bg-gray-50 focus:outline-hidden focus:bg-gray-50 disabled:opacity-50 disabled:pointer-events-none w-full"
								   href="{{ dog.pedigree }}">
									Родословная
								</a>
							{% endif %}

							{% if dog.category == "puppy" %}
								{% with message="Здравствуйте. Хочу забронировать щенка " %}
									<a class="font-montserrat py-3 px-4 justify-center inline-flex items-center gap-x-1 text-sm font-medium rounded-2xl border border-gray-200 bg-white text-gray-800 shadow-2xs hover:bg-gray-50 focus:outline-hidden focus:bg-gray-50 disabled:opacity-50 disabled:pointer-events-none w-full"
									   href="https://wa.me/79688212621?text={{ message|add:dog.name|urlencode }}"
									   target="_blank" rel="noopener noreferrer">
										Забронировать
									</a>
								{% endwith %}
							{% endif %}
						</div>
					</div>
				</div>

				<!-- Блок 3 -->
				<div class="rounded-3xl lg:col-span-2 lg:row-start-2 p-4">
					<div class="columns-2 gap-2 md:columns-3 lg:columns-4 [&>img:not(:first-child)]:mt-2 rounded-3xl">
						{% if dog.images.all %}
							{% for img in dog.images.all %}
								<div class="overflow-hidden rounded-3xl mb-2">
									<img src="{{ img.image.url }}"
									     alt="{{ dog.name }} — фото {{ forloop.counter }}"
									     class="w-full h-full object-cover transform transition-transform duration-300 ease-in-out hover:scale-105"
									     loading="lazy" aria-haspopup="dialog" aria-expanded="false"
									     aria-controls="hs-scale-animation-modal"
									     data-hs-overlay="#hs-scale-animation-modal">
								</div>
							{% endfor %}
						{% endif %}
					</div>
				</div>
				<div id="hs-scale-animation-modal"
				     class="hs-overlay hidden size-full fixed top-0 start-0 z-80 overflow-x-hidden overflow-y-auto pointer-events-none"
				     role="dialog" tabindex="-1" aria-labelledby="hs-scale-animation-modal-label">
					<div class="hs-overlay-animation-target hs-overlay-open:scale-100 hs-overlay-open:opacity-100 scale-95 opacity-0 ease-in-out transition-all duration-200 sm:max-w-lg sm:w-full m-3 sm:mx-auto min-h-[calc(100%-56px)] flex items-center">

					</div>
				</div>
			</div>


		</div>
	</div>

	<script>
        document.addEventListener("DOMContentLoaded", function () {
            const modal = document.querySelector("#hs-scale-animation-modal .hs-overlay-animation-target");

            document.querySelectorAll("[data-hs-overlay='#hs-scale-animation-modal']").forEach(img => {
                img.addEventListener("click", () => {
                    const imgSrc = img.getAttribute("src");
                    const imgAlt = img.getAttribute("alt");

                    // Очистим модалку и вставим новое изображение
                    modal.innerHTML = `
                <div class="rounded-3xl overflow-hidden shadow-lg max-w-3xl w-full mx-auto">
                    <img src="${imgSrc}" alt="${imgAlt}" class="w-full h-auto object-contain">
                </div>
            `;
                });
            });
        });
	</script>
{% endblock %}
